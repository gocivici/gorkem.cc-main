---
title: "Guestbook"
header: "AstroSketch Invert"
layout: "base.njk"
---

<style>
canvas{
  width:100%;
}
#img{
  display:none;
}
.astroContainer{
  font-size:16px;
}
.astroContainer form{
  font-size:16px;
}
.astroContainer input{
  font-size:16px;
}
#dl{
  display:none;
  font-size: 16px;
  text-align: center;
  margin: 15px;
}
#result{
   text-align:center; 
   font-size:16px;
   display:none;
}
</style>

<div id="flex">
  <div class="left-box">
    <div class="window main-left">
      <div class="title-bar inactive">
        <div class="title-bar-text">AstroSketch Grayscale & Invert Tool</div>
        <div class="title-bar-controls">
          <!-- <button aria-label="Help"></button> -->
          <button disabled aria-label="Close"></button>
        </div>
      </div>
      <div class="window-body">
        <main class="astroContainer">
        <form>
          <p>Upload your sketch using the button below:</p>
        {# <p><label for="file" style="cursor: pointer;"><b>Upload Image</b></label></p> #}
        <p><input type="file" accept="image/*;capture=camera" name="image" id="file"  onchange="loadFile(event)"></p>

        {# <label for="BrightnessSlider">Brightness (<span id="BrightnessValue">0</span>)</label>
<br>
<input id="BrightnessSlider" type="range" value="50" min="-100" max="100">
<br>
<label for="ContrastSlider">Contrast (<span id="ContrastValue">0</span>)</label>
<br>
<input type="range" id="ContrastSlider" value="0" min="-100" max="100"> #}

        <img id="img" />

        </form>
        </main>

        <script>
            let loadFile = function(event) {
            
          let image = document.getElementById("img");
          image.crossOrigin = "anonymous";
          image.src = URL.createObjectURL(event.target.files[0]);  
        };

        document.getElementById("img").onload = (event => {
          let canvas = document.createElement("canvas");
          let context = canvas.getContext("2d");
          canvas.width = event.target.width;
          canvas.height = event.target.height;
          document.getElementById("output").appendChild(canvas);
          context.drawImage(event.target, 0, 0);
          let imageData = context.getImageData(0, 0, canvas.width, canvas.height);
          let data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
            const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
            data[i] = avg; // red
            data[i + 1] = avg; // green
            data[i + 2] = avg; // blue
          }
          for (var i = 0; i < data.length; i += 4) {
              data[i]     = 255 - data[i]; // red
              data[i + 1] = 255 - data[i + 1]; // green
              data[i + 2] = 255 - data[i + 2]; // blue
            }
            context.putImageData(imageData, 0, 0);
            function dlCanvas() {
                var dt = canvas.toDataURL('image/png');
                /* Change MIME type to trick the browser to downlaod the file instead of displaying it */
                dt = dt.replace(/^data:image\/[^;]*/, 'data:application/octet-stream');

                /* In addition to <a>'s "download" attribute, you can define HTTP-style headers */
                dt = dt.replace(/^data:application\/octet-stream/, 'data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20filename=Sketch.png');

                this.href = dt;
              };
              document.getElementById("dl").addEventListener('click', dlCanvas, false);
              document.getElementById("result").style.display = "block";
              document.getElementById("dl").style.display = "block";
            //let downloadimage = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
            //console.log(downloadimage);
        });

          // here is the most important part because if you dont replace you will get a DOM 18 exception.

        
        {# window.location.href=downloadimage; // it will save locally #}


        </script>

        </div>
        </div>
                <p id="result">Converted Image</p>
                
        {# (Right click or hold to save) #}
        <div id="output"> </div>
        <a id="dl" download="Sketch.png" href="#">Download Result</a>
</div>
</div>



        






{# <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script> #}

<script src="/custom.js"></script>
<script src="/bgswitch.js"></script>
